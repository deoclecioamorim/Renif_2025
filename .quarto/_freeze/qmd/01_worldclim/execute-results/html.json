{
  "hash": "3a44300374cc269a5283ba61d7d4dc88",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Extração de dados climáticos do Worldclim\"\nauthor: \"Deoclecio J. Amorim (CENA), João Paulo Sena-Souza (Unimontes) e Paulo José Duarte Neto (UFRPE)\"\nformat:\n  html:\n    page-layout: full       # usa toda a largura da janela\n    toc: true\n    toc-location: left\n    fig-width: 5\n    fig-height: 5\nknitr: \n  opts_chunk: \n    fig-align: center\n---\n\n\n\n# Introdução\n\nAqui o nosso objetivo é apresentar um fluxo completo de extração, recorte e análise de dados climáticos globais do [WorldClim](https://www.worldclim.org/), focando na América do Sul.\n\nOs principais passos são:\n\n- Limpeza do ambiente de trabalho;\n- Instalação e carregamento de pacotes necessários;\n- Download e recorte de dados climáticos globais;\n- Reprojeção para o sistema de coordenadas SIRGAS2000 (EPSG:4674);\n- Cálculo de médias anuais;\n- Exportação dos resultados em formato raster TIFF.\n\n---\n\n# 1. Configuração inicial\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# Limpar área de trabalho\nrm(list = ls())      \ngc(reset = TRUE)     \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n          used (Mb) gc trigger (Mb) max used (Mb)\nNcells  607655 32.5    1384772   74   607655 32.5\nVcells 1106956  8.5    8388608   64  1106956  8.5\n```\n\n\n:::\n\n```{.r .cell-code}\ngraphics.off()       \n\n# Pacotes necessários\nif(!require(readxl))install.packages(\"readxl\", dep = TRUE)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCarregando pacotes exigidos: readxl\n```\n\n\n:::\n\n```{.r .cell-code}\nif(!require(tidyverse))install.packages(\"tidyverse\", dep = TRUE)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCarregando pacotes exigidos: tidyverse\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.5\n✔ forcats   1.0.0     ✔ stringr   1.5.1\n✔ ggplot2   3.5.2     ✔ tibble    3.2.1\n✔ lubridate 1.9.4     ✔ tidyr     1.3.1\n✔ purrr     1.0.4     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n\n\n:::\n\n```{.r .cell-code}\nif(!require(terra))install.packages(\"terra\", dep = TRUE)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCarregando pacotes exigidos: terra\nterra 1.8.50\n\nAnexando pacote: 'terra'\n\nO seguinte objeto é mascarado por 'package:tidyr':\n\n    extract\n\nO seguinte objeto é mascarado por 'package:knitr':\n\n    spin\n```\n\n\n:::\n\n```{.r .cell-code}\nif(!require(geodata))install.packages(\"geodata\", dep = TRUE)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCarregando pacotes exigidos: geodata\n```\n\n\n:::\n\n```{.r .cell-code}\nif(!require(geobr))install.packages(\"geobr\", dep = TRUE)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCarregando pacotes exigidos: geobr\nCarregando namespace exigido: sf\n```\n\n\n:::\n\n```{.r .cell-code}\nif(!require(sf))install.packages(\"sf\", dep = TRUE)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCarregando pacotes exigidos: sf\nLinking to GEOS 3.13.1, GDAL 3.10.2, PROJ 9.5.1; sf_use_s2() is TRUE\n```\n\n\n:::\n\n```{.r .cell-code}\nif(!require(sp))install.packages(\"sp\", dep = TRUE)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCarregando pacotes exigidos: sp\n```\n\n\n:::\n\n```{.r .cell-code}\nif(!require(here))install.packages(\"here\", dep = TRUE)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCarregando pacotes exigidos: here\nhere() starts at C:/Users/DELL/OneDrive/Documentos/Cena/Cursos_Extensao_CENA/renif_2025\n```\n\n\n:::\n:::\n\n\n---\n\n# 2. Exemplo: Temperatura média global (tavg)\n\nNeste exemplo, vamos obter os arquivos raster de temperatura média para o mundo, na resolução de 10 minutos. Outras resoluções podem ser facilmente obtidas alterando o argumento `res`. \n\nO argumento `var` oferece várias opções de variáveis climáticas, conforme a seguir:\n\n- `\"tmin\"` — Temperatura mínima\n- `\"tmax\"` — Temperatura máxima\n- `\"tavg\"` — Temperatura média\n- `\"prec\"` — Precipitação\n- `\"wind\"` — Velocidade do vento\n- `\"vapr\"` — Pressão de vapor\n- `\"bio\"` — Variáveis bioclimáticas\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# Baixando temperatura média global com resolução de 10 minutos\ntavg_mundo <- geodata::worldclim_global(var = \"tavg\", res = 5, path = here(\"worldclim\"))\nprint(class(tavg_mundo))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"SpatRaster\"\nattr(,\"package\")\n[1] \"terra\"\n```\n\n\n:::\n\n```{.r .cell-code}\nprint(terra::crs(tavg_mundo))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"GEOGCRS[\\\"WGS 84\\\",\\n    ENSEMBLE[\\\"World Geodetic System 1984 ensemble\\\",\\n        MEMBER[\\\"World Geodetic System 1984 (Transit)\\\"],\\n        MEMBER[\\\"World Geodetic System 1984 (G730)\\\"],\\n        MEMBER[\\\"World Geodetic System 1984 (G873)\\\"],\\n        MEMBER[\\\"World Geodetic System 1984 (G1150)\\\"],\\n        MEMBER[\\\"World Geodetic System 1984 (G1674)\\\"],\\n        MEMBER[\\\"World Geodetic System 1984 (G1762)\\\"],\\n        MEMBER[\\\"World Geodetic System 1984 (G2139)\\\"],\\n        MEMBER[\\\"World Geodetic System 1984 (G2296)\\\"],\\n        ELLIPSOID[\\\"WGS 84\\\",6378137,298.257223563,\\n            LENGTHUNIT[\\\"metre\\\",1]],\\n        ENSEMBLEACCURACY[2.0]],\\n    PRIMEM[\\\"Greenwich\\\",0,\\n        ANGLEUNIT[\\\"degree\\\",0.0174532925199433]],\\n    CS[ellipsoidal,2],\\n        AXIS[\\\"geodetic latitude (Lat)\\\",north,\\n            ORDER[1],\\n            ANGLEUNIT[\\\"degree\\\",0.0174532925199433]],\\n        AXIS[\\\"geodetic longitude (Lon)\\\",east,\\n            ORDER[2],\\n            ANGLEUNIT[\\\"degree\\\",0.0174532925199433]],\\n    USAGE[\\n        SCOPE[\\\"Horizontal component of 3D system.\\\"],\\n        AREA[\\\"World.\\\"],\\n        BBOX[-90,-180,90,180]],\\n    ID[\\\"EPSG\\\",4326]]\"\n```\n\n\n:::\n:::\n\n\nNo estudo de caso, estamos trabalhando apenas com a América do Sul, portanto, faz sentido utilizarmos apenas um recorte específico.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# 1. Carregar shapefile da Amazônia Legal\namz <- terra::vect(here::here(\"shapefiles\", \"amazonia_legal.shp\"))\n\n# Calcular área em km²\narea_amz_km2 <- sum(terra::expanse(amz, unit = \"km\"))\narea_amz_km2\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 5082259\n```\n\n\n:::\n\n```{.r .cell-code}\n# 2. Recortar o raster (usa o bounding box)\ntavg_crop <- terra::crop(tavg_mundo, amz)\n\n# 3. Aplicar máscara para manter apenas os pixels dentro do shape\ntavg_amz <- terra::mask(tavg_crop, amz)\n\n# 4. Visualizar um dos meses (exemplo: janeiro)\nterra::plot(tavg_amz[[1]], main = \"Janeiro\")\n```\n\n::: {.cell-output-display}\n![](01_worldclim_files/figure-html/mascara-1.png){fig-align='center' width=480}\n:::\n\n```{.r .cell-code}\n# Resolução espacial\nterra::res(tavg_amz[[1]])\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.08333333 0.08333333\n```\n\n\n:::\n\n```{.r .cell-code}\n# área de cada célula em km²\n# Area = (res*1º latitude (111,32km))*(res*1º logitude (109,7 km))\n# Area=(0.08333333×111.32)×(0.08333333×109.7)≈9.28×9.14≈84.8 km²\npixel_area <- terra::cellSize(tavg_amz[[1]], unit = \"km\")  \nterra::summary(pixel_area)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: [summary] used a sample\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n      area      \n Min.   :81.42  \n 1st Qu.:83.62  \n Median :84.97  \n Mean   :84.40  \n 3rd Qu.:85.37  \n Max.   :85.48  \n```\n\n\n:::\n:::\n\n\nFinalmente, recomenda-se corrigir a projeção e realizar as operações geoespaciais com os arquivos raster.\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# Reprojetar e calcular média\ntavg_amz_sirgas <- terra::project(tavg_amz, \"EPSG:4674\")\nsum(tavg_amz_sirgas)/12\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nclass       : SpatRaster \ndimensions  : 279, 386, 1  (nrow, ncol, nlyr)\nresolution  : 0.08333333, 0.08333333  (x, y)\nextent      : -74, -41.83333, -18, 5.25  (xmin, xmax, ymin, ymax)\ncoord. ref. : lon/lat SIRGAS 2000 (EPSG:4674) \nsource(s)   : memory\nname        :      sum \nmin value   : 18.63950 \nmax value   : 27.97333 \n```\n\n\n:::\n\n```{.r .cell-code}\ntavg_mean <- terra::app(tavg_amz_sirgas, mean)\n\n# Visualizar e salvar resultado\nterra::plot(tavg_mean, main = \"Temperatura Média\")\n```\n\n::: {.cell-output-display}\n![](01_worldclim_files/figure-html/projecao-1.png){fig-align='center' width=480}\n:::\n\n```{.r .cell-code}\n# Criar a pasta 'raster' na raiz do projeto\nif (!dir.exists(here(\"raster\"))) dir.create(here(\"raster\"))\n\n# Salvar o raster dentro da pasta 'raster'\nterra::writeRaster(tavg_mean, filename = here(\"raster\", \"tavg_mean.tif\"), overwrite = TRUE)\n```\n:::\n\n\n# 3. Exemplo: Temperatura máxima (tmax)\n\nAqui, realizamos as mesmas operações para obter a temperatura máxima.\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ntmax_mundo <- geodata::worldclim_global(var = \"tmax\", res = 10, path = here(\"worldclim\"))\nprint(class(tmax_mundo))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"SpatRaster\"\nattr(,\"package\")\n[1] \"terra\"\n```\n\n\n:::\n\n```{.r .cell-code}\nprint(terra::crs(tmax_mundo))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"GEOGCRS[\\\"WGS 84\\\",\\n    ENSEMBLE[\\\"World Geodetic System 1984 ensemble\\\",\\n        MEMBER[\\\"World Geodetic System 1984 (Transit)\\\"],\\n        MEMBER[\\\"World Geodetic System 1984 (G730)\\\"],\\n        MEMBER[\\\"World Geodetic System 1984 (G873)\\\"],\\n        MEMBER[\\\"World Geodetic System 1984 (G1150)\\\"],\\n        MEMBER[\\\"World Geodetic System 1984 (G1674)\\\"],\\n        MEMBER[\\\"World Geodetic System 1984 (G1762)\\\"],\\n        MEMBER[\\\"World Geodetic System 1984 (G2139)\\\"],\\n        MEMBER[\\\"World Geodetic System 1984 (G2296)\\\"],\\n        ELLIPSOID[\\\"WGS 84\\\",6378137,298.257223563,\\n            LENGTHUNIT[\\\"metre\\\",1]],\\n        ENSEMBLEACCURACY[2.0]],\\n    PRIMEM[\\\"Greenwich\\\",0,\\n        ANGLEUNIT[\\\"degree\\\",0.0174532925199433]],\\n    CS[ellipsoidal,2],\\n        AXIS[\\\"geodetic latitude (Lat)\\\",north,\\n            ORDER[1],\\n            ANGLEUNIT[\\\"degree\\\",0.0174532925199433]],\\n        AXIS[\\\"geodetic longitude (Lon)\\\",east,\\n            ORDER[2],\\n            ANGLEUNIT[\\\"degree\\\",0.0174532925199433]],\\n    USAGE[\\n        SCOPE[\\\"Horizontal component of 3D system.\\\"],\\n        AREA[\\\"World.\\\"],\\n        BBOX[-90,-180,90,180]],\\n    ID[\\\"EPSG\\\",4326]]\"\n```\n\n\n:::\n\n```{.r .cell-code}\ntmax_crop <- terra::crop(tmax_mundo, amz)\n# 3. Aplicar máscara para manter apenas os pixels dentro do shape\ntmax_amz <- terra::mask(tmax_crop, amz)\n\n# 4. Visualizar um dos meses (exemplo: janeiro)\nterra::plot(tmax_amz[[10]], main = \"Temperatura Máxima: Outubro\")\n```\n\n::: {.cell-output-display}\n![](01_worldclim_files/figure-html/tmax-1.png){fig-align='center' width=480}\n:::\n\n```{.r .cell-code}\ntmax_amz_sirgas <- terra::project(tmax_amz, \"EPSG:4674\")\ntmax_mean <- terra::app(tmax_amz_sirgas, mean)\nterra::plot(tmax_mean, main = \"Temperatura Máxima Média\")\n```\n\n::: {.cell-output-display}\n![](01_worldclim_files/figure-html/tmax-2.png){fig-align='center' width=480}\n:::\n\n```{.r .cell-code}\n#Salvar\nterra::writeRaster(tmax_mean, filename = here(\"raster\", \"tmax_mean.tif\"), overwrite = TRUE)\n```\n:::\n\nNo banco de dados [WorldClim](https://www.worldclim.org/), existem diversas variáveis climáticas disponíveis. Surge, então, a pergunta: **será que existe uma maneira de trabalhar com múltiplas variáveis ao mesmo tempo?**\n\nA seguir, apresenta-se um bloco de código que realiza essa tarefa. Com certeza, existem formas mais elegantes e eficientes de implementar essa rotina, mas isso exigiria um pouco mais de criatividade e imaginação.\n\n---\n\n# 4. Automatizando o processamento de variáveis\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# Lista de variáveis climáticas a processar\nvars <- c(\"tavg\", \"tmax\", \"tmin\", \"prec\",\"srad\",\"vapr\",\"elev\")\ndata_path <- here(\"worldclim\")\n\n\n# Loop de download e processamento\nfor (var in vars) {\n  climate_data <- tryCatch(\n    geodata::worldclim_global(var = var, res = 5, path = data_path),\n    error = function(e) {\n      message(paste(\"Erro ao baixar:\", var, \"->\", e$message))\n      return(NULL)\n    }\n  )\n\n  if (is.null(climate_data)) next\n\n  message(paste(\"Processando:\", var))\n  \n  # Recorte e projeção\n  climate_amz_crop <- terra::crop(climate_data, amz)\n  climate_amz <- terra::mask(climate_amz_crop, amz)\n  \n  climate_amz_sirgas <- terra::project(climate_amz, \"EPSG:4674\")\n  \n  # Média anual\n  climate_mean <- terra::app(climate_amz_sirgas, mean)\n  terra::plot(climate_mean, main = paste(\"Média -\", var))\n  \n  # Caminho do arquivo de saída\n  output_filename <- here(\"raster\", paste0(var, \"_mean.tif\"))\n  terra::writeRaster(climate_mean, filename = output_filename, overwrite = TRUE)\n  \n  message(paste(\"Arquivo salvo em:\", output_filename))\n}\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nProcessando: tavg\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](01_worldclim_files/figure-html/extr_auto-1.png){fig-align='center' width=480}\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nArquivo salvo em: C:/Users/DELL/OneDrive/Documentos/Cena/Cursos_Extensao_CENA/renif_2025/raster/tavg_mean.tif\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nProcessando: tmax\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](01_worldclim_files/figure-html/extr_auto-2.png){fig-align='center' width=480}\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nArquivo salvo em: C:/Users/DELL/OneDrive/Documentos/Cena/Cursos_Extensao_CENA/renif_2025/raster/tmax_mean.tif\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nProcessando: tmin\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](01_worldclim_files/figure-html/extr_auto-3.png){fig-align='center' width=480}\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nArquivo salvo em: C:/Users/DELL/OneDrive/Documentos/Cena/Cursos_Extensao_CENA/renif_2025/raster/tmin_mean.tif\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nProcessando: prec\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](01_worldclim_files/figure-html/extr_auto-4.png){fig-align='center' width=480}\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nArquivo salvo em: C:/Users/DELL/OneDrive/Documentos/Cena/Cursos_Extensao_CENA/renif_2025/raster/prec_mean.tif\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nProcessando: srad\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](01_worldclim_files/figure-html/extr_auto-5.png){fig-align='center' width=480}\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nArquivo salvo em: C:/Users/DELL/OneDrive/Documentos/Cena/Cursos_Extensao_CENA/renif_2025/raster/srad_mean.tif\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nProcessando: vapr\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](01_worldclim_files/figure-html/extr_auto-6.png){fig-align='center' width=480}\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nArquivo salvo em: C:/Users/DELL/OneDrive/Documentos/Cena/Cursos_Extensao_CENA/renif_2025/raster/vapr_mean.tif\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nProcessando: elev\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](01_worldclim_files/figure-html/extr_auto-7.png){fig-align='center' width=480}\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nArquivo salvo em: C:/Users/DELL/OneDrive/Documentos/Cena/Cursos_Extensao_CENA/renif_2025/raster/elev_mean.tif\n```\n\n\n:::\n:::\n\n",
    "supporting": [
      "01_worldclim_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}