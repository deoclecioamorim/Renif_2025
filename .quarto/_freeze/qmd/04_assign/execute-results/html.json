{
  "hash": "3e423442cf471207596c4e93d5f1a49e",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Atribuição\"\nauthor: \"Deoclecio J. Amorim (CENA), João Paulo Sena-Souza (Unimontes) e Paulo José Duarte Neto (UFRPE)\"\nformat:\n  html:\n    page-layout: full       # usa toda a largura da janela\n    toc: true\n    toc-location: left\n    fig-width: 5\n    fig-height: 5\nknitr: \n  opts_chunk: \n    fig-align: center\n---\n\n\n\n\n## Configuração inicial\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# Limpar área de trabalho\nrm(list = ls())      \ngc(reset = TRUE)     \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n          used (Mb) gc trigger (Mb) max used (Mb)\nNcells  608188 32.5    1384530   74   608188 32.5\nVcells 1111716  8.5    8388608   64  1111716  8.5\n```\n\n\n:::\n\n```{.r .cell-code}\ngraphics.off()       \n\n#Pacotes necessários\nif(!require(readxl))install.packages(\"readxl\", dep = TRUE, quiet = TRUE)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCarregando pacotes exigidos: readxl\n```\n\n\n:::\n\n```{.r .cell-code}\nif(!require(tidyverse))install.packages(\"tidyverse\", dep = TRUE, quiet = TRUE)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCarregando pacotes exigidos: tidyverse\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.5\n✔ forcats   1.0.0     ✔ stringr   1.5.1\n✔ ggplot2   3.5.2     ✔ tibble    3.2.1\n✔ lubridate 1.9.4     ✔ tidyr     1.3.1\n✔ purrr     1.0.4     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n\n\n:::\n\n```{.r .cell-code}\nif(!require(terra))install.packages(\"terra\", dep = TRUE, quiet = TRUE)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCarregando pacotes exigidos: terra\nterra 1.8.50\n\nAnexando pacote: 'terra'\n\nO seguinte objeto é mascarado por 'package:tidyr':\n\n    extract\n\nO seguinte objeto é mascarado por 'package:knitr':\n\n    spin\n```\n\n\n:::\n\n```{.r .cell-code}\nif(!require(geodata))install.packages(\"geodata\", dep = TRUE, quiet = TRUE)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCarregando pacotes exigidos: geodata\n```\n\n\n:::\n\n```{.r .cell-code}\nif(!require(geobr))install.packages(\"geobr\", dep = TRUE, quiet = TRUE)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCarregando pacotes exigidos: geobr\nCarregando namespace exigido: sf\n```\n\n\n:::\n\n```{.r .cell-code}\nif(!require(sf))install.packages(\"sf\", dep = TRUE, quiet = TRUE)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCarregando pacotes exigidos: sf\nLinking to GEOS 3.13.1, GDAL 3.10.2, PROJ 9.5.1; sf_use_s2() is TRUE\n```\n\n\n:::\n\n```{.r .cell-code}\nif(!require(sp))install.packages(\"sp\", dep = TRUE, quiet = TRUE)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCarregando pacotes exigidos: sp\n```\n\n\n:::\n\n```{.r .cell-code}\nif(!require(here))install.packages(\"here\", dep = TRUE, quiet = TRUE)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCarregando pacotes exigidos: here\nhere() starts at C:/Users/DELL/OneDrive/Documentos/Cena/Cursos_Extensao_CENA/renif_2025\n```\n\n\n:::\n\n```{.r .cell-code}\nif(!require(assignR))install.packages(\"assignR\", dep = TRUE, quiet = TRUE)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCarregando pacotes exigidos: assignR\nknownOrig database version 0.2, 4352 samples from 1986 sites.\n```\n\n\n:::\n\n```{.r .cell-code}\nif(!require(viridis))install.packages(\"viridis\", dep = TRUE, quiet = TRUE)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCarregando pacotes exigidos: viridis\nCarregando pacotes exigidos: viridisLite\n```\n\n\n:::\n:::\n\n\n## Introdução\n\nO objetivo final com os isoscapes é usá-los para inferir a provável origem geográfica \ndo material de estudo.\n\nVamos supor o seguinte cenário: Estudar se uma determinada amostra provem do estado do \nAmazonas ou do Mato grosso. Vamos usar a isoscape gerada pelo modelo RF.\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# 1) Ler o shapefile das UFs (Amazônia Legal)\nfu <- terra::vect(here::here(\"shapefiles\", \"fu.shp\"))\nfu <- terra::project(fu, \"EPSG:4674\")\n\ncrs(fu)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"GEOGCRS[\\\"SIRGAS 2000\\\",\\n    DATUM[\\\"Sistema de Referencia Geocentrico para las AmericaS 2000\\\",\\n        ELLIPSOID[\\\"GRS 1980\\\",6378137,298.257222101,\\n            LENGTHUNIT[\\\"metre\\\",1]]],\\n    PRIMEM[\\\"Greenwich\\\",0,\\n        ANGLEUNIT[\\\"degree\\\",0.0174532925199433]],\\n    CS[ellipsoidal,2],\\n        AXIS[\\\"geodetic latitude (Lat)\\\",north,\\n            ORDER[1],\\n            ANGLEUNIT[\\\"degree\\\",0.0174532925199433]],\\n        AXIS[\\\"geodetic longitude (Lon)\\\",east,\\n            ORDER[2],\\n            ANGLEUNIT[\\\"degree\\\",0.0174532925199433]],\\n    USAGE[\\n        SCOPE[\\\"Horizontal component of 3D system.\\\"],\\n        AREA[\\\"Latin America - Central America and South America - onshore and offshore. Brazil - onshore and offshore.\\\"],\\n        BBOX[-59.87,-122.19,32.72,-25.28]],\\n    ID[\\\"EPSG\\\",4674]]\"\n```\n\n\n:::\n\n```{.r .cell-code}\n# Veja os nomes de campos disponíveis para filtrar\n# names(fu)\n\nfu.names <- c(\"Amazonas\", \"Mato Grosso\")\nfus <- fu[fu$ADM1_PT %in% fu.names]\n\n# 2) Ler isoscape gerada pelo modelo RF\niso_files <- list.files(path = here::here(\"isoscape\"), pattern = \"\\\\.tif$\", full.names = TRUE)\niso_d13   <- terra::rast(iso_files)\n\n# Conferir CRS\ncrs(fu)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"GEOGCRS[\\\"SIRGAS 2000\\\",\\n    DATUM[\\\"Sistema de Referencia Geocentrico para las AmericaS 2000\\\",\\n        ELLIPSOID[\\\"GRS 1980\\\",6378137,298.257222101,\\n            LENGTHUNIT[\\\"metre\\\",1]]],\\n    PRIMEM[\\\"Greenwich\\\",0,\\n        ANGLEUNIT[\\\"degree\\\",0.0174532925199433]],\\n    CS[ellipsoidal,2],\\n        AXIS[\\\"geodetic latitude (Lat)\\\",north,\\n            ORDER[1],\\n            ANGLEUNIT[\\\"degree\\\",0.0174532925199433]],\\n        AXIS[\\\"geodetic longitude (Lon)\\\",east,\\n            ORDER[2],\\n            ANGLEUNIT[\\\"degree\\\",0.0174532925199433]],\\n    USAGE[\\n        SCOPE[\\\"Horizontal component of 3D system.\\\"],\\n        AREA[\\\"Latin America - Central America and South America - onshore and offshore. Brazil - onshore and offshore.\\\"],\\n        BBOX[-59.87,-122.19,32.72,-25.28]],\\n    ID[\\\"EPSG\\\",4674]]\"\n```\n\n\n:::\n\n```{.r .cell-code}\ncrs(iso_d13)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"GEOGCRS[\\\"SIRGAS 2000\\\",\\n    DATUM[\\\"Sistema de Referencia Geocentrico para las AmericaS 2000\\\",\\n        ELLIPSOID[\\\"GRS 1980\\\",6378137,298.257222101004,\\n            LENGTHUNIT[\\\"metre\\\",1]]],\\n    PRIMEM[\\\"Greenwich\\\",0,\\n        ANGLEUNIT[\\\"degree\\\",0.0174532925199433]],\\n    CS[ellipsoidal,2],\\n        AXIS[\\\"geodetic latitude (Lat)\\\",north,\\n            ORDER[1],\\n            ANGLEUNIT[\\\"degree\\\",0.0174532925199433]],\\n        AXIS[\\\"geodetic longitude (Lon)\\\",east,\\n            ORDER[2],\\n            ANGLEUNIT[\\\"degree\\\",0.0174532925199433]],\\n    ID[\\\"EPSG\\\",4674]]\"\n```\n\n\n:::\n\n```{.r .cell-code}\nsame.crs(fu, iso_d13)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] TRUE\n```\n\n\n:::\n\n```{.r .cell-code}\nfus.mu <- extract(iso_d13[[1]], fus, \"mean\", na.rm = TRUE)\nfus.mu$ID = fu.names\nfus.mu\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n           ID      lyr1\n1    Amazonas -29.31578\n2 Mato Grosso -28.34664\n```\n\n\n:::\n:::\n\n\nOs valores médios `d13C_wood` previstos pelos nossos mapas isotópicos para os dois estados diferem em cerca de 0.97% (por mil). \n\n- Com base nisso é possivel determinar se uma amostra provem de algum desses estados? Por exemplo,\na amostra 103 provem do Amazonas ou Mato Grosso?\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\namz_var_clim <- readxl::read_excel(here::here(\"dados\", \"madeira_amz_var_clim.xlsx\"), sheet = 1)\nhead(amz_var_clim) #leitura das primeiras 6 linhas\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 12\n      x      y Site     Family d13C_wood elev_mean prec_mean srad_mean tavg_mean\n  <dbl>  <dbl> <chr>    <chr>      <dbl>     <dbl>     <dbl>     <dbl>     <dbl>\n1 -67.0 -0.121 São Gab… Myris…        NA      85.4      234.    14214.      26.0\n2 -67.0 -0.121 São Gab… Myris…        NA      85.4      234.    14214.      26.0\n3 -67.0 -0.121 São Gab… Myris…        NA      85.4      234.    14214.      26.0\n4 -67.0 -0.121 São Gab… Myris…        NA      85.4      234.    14214.      26.0\n5 -67.0 -0.121 São Gab… Myris…        NA      85.4      234.    14214.      26.0\n6 -66.9 -0.041 São Gab… Burse…        NA      93.4      230.    14186.      26.1\n# ℹ 3 more variables: tmax_mean <dbl>, tmin_mean <dbl>, vapr_mean <dbl>\n```\n\n\n:::\n\n```{.r .cell-code}\nstr(amz_var_clim) #Estrutura dos dados\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\ntibble [2,377 × 12] (S3: tbl_df/tbl/data.frame)\n $ x        : num [1:2377] -67 -67 -67 -67 -67 ...\n $ y        : num [1:2377] -0.121 -0.121 -0.121 -0.121 -0.121 -0.041 -0.041 -0.041 -0.041 -0.041 ...\n $ Site     : chr [1:2377] \"São Gabriel da Cachoeira\" \"São Gabriel da Cachoeira\" \"São Gabriel da Cachoeira\" \"São Gabriel da Cachoeira\" ...\n $ Family   : chr [1:2377] \"Myristicaceae\" \"Myristicaceae\" \"Myristicaceae\" \"Myristicaceae\" ...\n $ d13C_wood: num [1:2377] NA NA NA NA NA NA NA NA NA NA ...\n $ elev_mean: num [1:2377] 85.4 85.4 85.4 85.4 85.4 ...\n $ prec_mean: num [1:2377] 234 234 234 234 234 ...\n $ srad_mean: num [1:2377] 14214 14214 14214 14214 14214 ...\n $ tavg_mean: num [1:2377] 26 26 26 26 26 ...\n $ tmax_mean: num [1:2377] 30.9 30.9 30.9 30.9 30.9 ...\n $ tmin_mean: num [1:2377] 21.2 21.2 21.2 21.2 21.2 ...\n $ vapr_mean: num [1:2377] 2.88 2.88 2.88 2.88 2.88 ...\n```\n\n\n:::\n\n```{.r .cell-code}\n#Tratando NAs\nd13.amz <- amz_var_clim[!is.na(amz_var_clim$d13C_wood), ]\n\n# Adicionando ID\nd13.amz$ID <- 1:nrow(d13.amz)\n\nd13.amz <- d13.amz %>% relocate(ID, .before = 1)\n\nunknown <- d13.amz[d13.amz$ID== 103,]\nunknown$d13C_wood\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] -29.9\n```\n\n\n:::\n:::\n\n\nDado o valor medido, como você julgaria qual unidade é a origem mais provável? A maioria dos algoritmos de classificação simples usa uma métrica de distância para avaliar a similaridade entre o valor da amostra e as classes possíveis, atribuindo então a amostra à classe mais similar. Por exemplo:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nfus.mu$inv.diff <- 1 / abs(unknown$d13C_wood - fus.mu[, 2])\nfus.mu\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n           ID      lyr1  inv.diff\n1    Amazonas -29.31578 1.7116804\n2 Mato Grosso -28.34664 0.6437659\n```\n\n\n:::\n:::\n\n\nCom base no inverso da distância podemos admitir que é mais coerente essa amostra\nser do Amazonas. Vejamos mais alguns detalhes:\n\n:::{#fuDist}\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ncols = viridis(2, begin = 0.2, end = 0.8)\nfus.all = extract(iso_d13, fus)\nd1 = density(fus.all[fus.all$ID == 1, 2], na.rm = TRUE)\nd2 = density(fus.all[fus.all$ID == 2, 2], na.rm = TRUE)\nplot(d1, xlim = range(fus.all[, 2], na.rm = TRUE), \n     ylim = range(c(d1$y, d2$y)), main = \"\", \n     xlab = expression(delta^{13}*\"C\"[\"wood\"]), col = cols[1], lwd = 3)\nlines(d2, col = cols[2], lwd = 3)\nabline(v = unknown$d13C_wood, lwd = 3, lty = 3)\nlegend(\"topleft\", fu.names, lwd = 3, col = cols, bty = \"n\")\n```\n\n::: {.cell-output-display}\n![](04_assign_files/figure-html/fuDist-1.png){fig-align='center' width=576}\n:::\n:::\n\n:::\n\nNote que agora as coisas parecem um pouco diferentes. O que não percebemos antes, quando avaliamos apenas as médias, é que as `d13C_wood` previsões para Mato Grosso estão restritas a uma faixa estreita de valores, enquanto as do Amazonas são muito mais dispersas. Como resultado, o valor da amostra desconhecida tem, na verdade, uma probabilidade maior de ocorrer no Amazonas. Podemos avaliar a diferença entre as probabilidades extraindo a densidade de probabilidade do valor da amostra por mil dos kernels para as duas regiões:\n\n:::{#fuRatio}\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\np1 <- d1$y[which.min(abs(unknown$d13C_wood - d1$x))]\np2 <- d2$y[which.min(abs(unknown$d13C_wood - d2$x))]\ncat(\"PD Amazonas = \", p1, \"\\nPD Mato Grosso = \", p2, \"\\nRatio = \", p1 / p2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nPD Amazonas =  0.4581069 \nPD Mato Grosso =  0.0001610313 \nRatio =  2844.831\n```\n\n\n:::\n:::\n\n:::\n\nIsso demonstra que a probabilidade de encontrar esse valor no Amazonas é muito maior do que no Mato Grosso, levantando a hipotese que realmente o Amazonas seja a região de origem mais provável.\n\nPodemos ir um passo além, no entanto, aplicando o Teorema de Bayes para fazer uma afirmação quantitativa sobre a probabilidade de cada unidade ser a verdadeira região de origem, partirmos das seguintes premissas:\n\n1) Nossa amostra desconhecida deve ter vindo de um dos dois estados, e\n\n2) Antes de considerarmos nossos dados isotópicos, ambos os estados têm a mesma probabilidade de serem a verdadeira origem.\n\nO Teorema de Bayes nos diz que a probabilidade de uma determinada região ser a verdadeira região de origem é igual à probabilidade de observarmos nossos dados isotópicos nessa região dividida pela probabilidade de observarmos os dados em qualquer uma das regiões. Acabamos de determinar as probabilidades para os dados acima, o que torna esse cálculo muito fácil:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndata.frame(\"Region\" = fu.names, \"Probalidade_posteiro\" = \n             c(p1 / sum(p1, p2), p2 / sum(p1, p2)))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n       Region Probalidade_posteiro\n1    Amazonas         0.9996486088\n2 Mato Grosso         0.0003513912\n```\n\n\n:::\n:::\n\n\nA probabilidade posterior é a probabilidade após considerarmos nossas novas evidências (isotópicas) e, como você pode ver aqui, ela sugere que há uma alta probabilidade (99%) de que nossa amostra desconhecida seja do Amazonas e não do Mato Grosso. Se quisermos 'atribuir' a amostra a uma região de origem mais provável, escolheríamos o Amazonas.\n\nResumindo nosso exemplo, a chave para atribuir a amostra a uma região geográfica é encontrar a probabilidade de nossa evidência (o valor da amostra `d13C_wood`) ocorrer em cada uma de nossas potenciais regiões de origem. Com essa informação, podemos aplicar o Teorema de Bayes para encontrar a probabilidade de cada região ser a verdadeira origem.\n\n\n## Isoscapes baseados em probabilidade\n\nUsando a isoscape gerada pelo modelo RF vamos considerar cada célula da grade no mapa de isótopos separadamente como uma possível localização de onde nossa amostra pode ter se originado. \n\nUma das implicações dessa abordagem é que agora estamos considerando um número muito grande de possíveis locais de origem. Esse número dependerá da extensão e da resolução do nosso mapa isotópico, mas, neste exemplo, o número é:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nsum(!is.na(values(iso_d13[[1]])))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 61093\n```\n\n\n:::\n\n```{.r .cell-code}\n# Cada pixel tem aproximadamente 85 km2\nterra::res(iso_d13[[1]])\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.08333333 0.08333333\n```\n\n\n:::\n:::\n\nConsequentemente, a probabilidade de qualquer célula da grade ser a localização real de origem será bastante pequena. Por exemplo, se nossa suposição inicial for que cada célula da grade tem a mesma probabilidade de ser a verdadeira origem da amostra, cada célula terá uma probabilidade de:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n1 / sum(!is.na(values(iso_d13[[1]])))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 1.636849e-05\n```\n\n\n:::\n:::\n\nEsses pequenos valores de probabilidade confundem um pouco, mas podemos ver aqui como eles surgem e que são esperados. Em geral, não estaremos interessados nos valores de probabilidade em si, mas na magnitude relativa das probabilidades para diferentes locais.\n\nPara aplicar nosso método baseado em probabilidade às células da grade do mapa de isótopos, precisamos conhecer as distribuições de probabilidade dos `d13C_wood` valores em cada célula. Nesse caso, vamos assumir a suposição de normalidade.\n\nPara realizar a análise (e ao longo do restante desta vinheta), usaremos funções do\n[`assignR` package](https://cran.r-project.org/package=assignR).\n\n\n::: {.cell layout-align=\"center\" fig.margin='false'}\n\n```{.r .cell-code}\nsam <- data.frame(\"ID\" = unknown$ID, \"d13C\" = unknown$d13C_wood)\np.map1 <-  pdRaster(iso_d13, sam, genplot = FALSE)\nuk.sp <- vect(unknown, geom = c(\"x\", \"y\"), crs = \"EPSG:4674\")\nfu.sub <- fu[fu$ADM1_PT %in% fu.names]\n\nplot(p.map1, axes = FALSE)\nlines(fu.sub, lwd = 2)\n#lines(brazil, lwd = 2)\npoints(uk.sp, pch = 21, cex = 2, lwd = 2, bg = \"white\")\n```\n\n::: {.cell-output-display}\n![](04_assign_files/figure-html/pdRaster-1.png){fig-align='center' width=90%}\n:::\n:::\n\nO mapa mostra a localização de origem verdadeira e conhecida desta amostra. É possível observar que ela não se encontra em uma região com probabilidade posterior particularmente alta. Também não está na região com as probabilidades mais baixas. Podemos extrair o valor real para esta localização, que se situa no meio do intervalo obtido na análise:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nextract(p.map1, uk.sp)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  ID          103\n1  1 3.786974e-05\n```\n\n\n:::\n:::\n\n\n\n\n## Inferência\n\nAlgumas perguntas:\n\n- 1) *De onde veio a amostra*? \n\n- 2) *Quais são os locais de origem mais prováveis*?\n\nA função `qtlRaster()` oferece duas opções para tentar responder essas questões,\na primeira (e padrão) baseada na área do mapa:\n\n\n::: {.cell layout-align=\"center\" fig.margin='false'}\n\n```{.r .cell-code}\nqt1 <- qtlRaster(p.map1, threshold =0.5, genplot = FALSE)\n\nplot(qt1, axes = FALSE)\nlines(fu.sub)\n#lines(brazil, lwd = 2)\npoints(uk.sp, pch = 21, cex = 1.5, lwd = 2, bg = \"white\")\n```\n\n::: {.cell-output-display}\n![](04_assign_files/figure-html/qt1-1.png){fig-align='center' width=90%}\n:::\n:::\n\n\nAqui extrairmos 50% da área de estudo, gerando mapas que mostram os 50% das \ncélulas da grade com a maior probabilidade posterior da amostra.\n\nA segunda opção de atribuição é um pouco menos arbitrária e envolve a seleção das células mais prováveis da malha isotópica que representam coletivamente uma certa quantidade da probabilidade posterior. Neste caso, escolhemos um valor de 0,95. Assim, podemos interpretar diretamente o resultado: tendo em conta os dados e os pressupostos da nossa análise, existe uma probabilidade de 95% de a amostra provir da área selecionada.\n\n\n\n:::{#qt2}\n\n::: {.cell layout-align=\"center\" fig.margin='false'}\n\n```{.r .cell-code}\nqt2<-qtlRaster(p.map1, threshold = 0.95, thresholdType = \"prob\", genplot = FALSE)\n\nplot(qt2, axes = FALSE)\nlines(fu.sub)\n#lines(brazil, lwd = 2)\npoints(uk.sp, pch = 21, cex = 1.5, lwd = 2)\n\nextract(qt2, uk.sp)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  ID  103\n1  1 TRUE\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](04_assign_files/figure-html/qt2-1.png){fig-align='center' width=90%}\n:::\n:::\n\n:::\n\nComo você pode ver, precisamos selecionar mais de 50% da área de estudo para atingir nosso limiar de probabilidade de 95%. Também é possível observar que, neste caso, a verdadeira localização de origem está incluída na região de atribuição.  Sempre haverá muitos locais onde um determinado valor pode ocorrer, mas pode ser bastante óbvio quando o valor de uma amostra não corresponde bem a um determinado local.\n\nUsando a razão de chances podemos responder Qual unidade federativa é a localização de origem mais provável, Amazonas ou Mato Grosso? \n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\noddsRatio(p.map1, fu.sub)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$`P1/P2 odds ratio`\n[1] 4.730936\n\n$`Ratio of numbers of cells in two polygons`\n[1] 1.72567\n```\n\n\n:::\n:::\n\nHá dois pontos a observar aqui:\n\n- A razão de chances indica que é 1,7 vezes mais provável que a amostra tenha vindo do Amazonas (que por acaso é o verdadeiro local de origem).\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npts = sample(which(fus.all$ID == 1), 5)\npts = c(pts, sample(which(fus.all$ID == 2), 5))\n\nplot(NULL, xlim = c(-32, -26), ylim = c(0, 0.7), \n     xlab = expression(delta^{13}*\"C\"[\"wood\"]), ylab = \"Density\")\n\nfor(i in pts){\n  lines(density(rnorm(1e6, fus.all[i, 2], fus.all[i, 3])), lwd = 3, \n        col = cols[fus.all[i, 1]])\n}\nabline(v = unknown$d13C_wood, lwd = 3, lty = 3)\nlegend(\"topleft\", fu.names, lwd = 3, col = cols, bty = \"n\")\n```\n\n::: {.cell-output-display}\n![](04_assign_files/figure-html/pdDist-1.png){fig-align='center' width=576}\n:::\n:::\n\n\n\nNossa análise de probabilidade de isótopos adiciona um fator importante que ignoramos implicitamente na análise de classificação original: a incerteza da previsão. Lembre-se de que nossos modelos de isótopos explicam apenas cerca de metade da `d13C_wood` variabilidade. A variação restante provém de duas fontes:\n\n- Erro do modelo - nosso modelo é imperfeito e não representa perfeitamente o padrão de `d13C_wood` valores médios na área de estudo.\n\n- Variabilidade local - árvores individuais que vivem no mesmo local podem apresentar valores que variam em vários por mil. Por exemplo, aqui está a distribuição de valores para árvores individuais da mesma família e local de coleta que nossa amostra de teste desconhecida:\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nplot(density(d13.amz$d13C_wood[d13.amz$Family == unknown$Family & \n                               d13.amz$Site == unknown$Site]),\n     xlab = expression(delta^{13}*\"C\"[\"wood\"]), main = \"\", lwd = 2)\n```\n\n::: {.cell-output-display}\n![](04_assign_files/figure-html/variance-1.png){fig-align='center' width=480}\n:::\n:::\n\nSe quisermos avaliar se uma amostra pode ter vindo deste local com base em seu `d13C_wood` valor, é importante conhecer o valor médio do local, mas também precisamos considerar a dispersão: claramente, valores que variam de -34 a -26 por mil são plausíveis neste local.\n\n### Qualidade da atribuição\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nknown <- d13.amz[d13.amz$Family == \"Burseraceae\", c(\"x\", \"y\", \"d13C_wood\")]\nknown <- vect(known, geom = c(\"x\", \"y\"), crs = \"EPSG:4674\")\nqa1 <- QA(known, iso_d13, bySite = FALSE, recal = FALSE)\n```\n:::\n\n\n::: {.cell layout-ncol=\"2\" layout-align=\"center\"}\n\n```{.r .cell-code}\nplot(qa1)\n```\n\n::: {.cell-output-display}\n![](04_assign_files/figure-html/plotQA-1.png){fig-align='center' width=480}\n:::\n\n::: {.cell-output-display}\n![](04_assign_files/figure-html/plotQA-2.png){fig-align='center' width=480}\n:::\n\n::: {.cell-output-display}\n![](04_assign_files/figure-html/plotQA-3.png){fig-align='center' width=480}\n:::\n\n::: {.cell-output-display}\n![](04_assign_files/figure-html/plotQA-4.png){fig-align='center' width=480}\n:::\n:::\n\n\n\n\n\n\n",
    "supporting": [
      "04_assign_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}